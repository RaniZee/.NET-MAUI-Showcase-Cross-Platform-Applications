<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:TaskTrackerMAUI.ViewModels"
             xmlns:models="clr-namespace:TaskTrackerMAUI.Models"
             x:Class="TaskTrackerMAUI.Views.TaskDetailPage"
             x:DataType="viewmodels:TaskDetailViewModel"
             Title="{Binding Title}"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}">

    <Grid>
        <ScrollView Padding="15" IsVisible="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}">
            <VerticalStackLayout Spacing="15">
                <Label Text="Название задачи" FontFamily="Bahnschrift"/>
                <Entry Text="{Binding Task.Title}" Placeholder="Введите название" FontFamily="Bahnschrift"/>

                <Label Text="Описание" FontFamily="Bahnschrift"/>
                <Editor Text="{Binding Task.Description}" Placeholder="Введите описание" AutoSize="TextChanges" HeightRequest="100" FontFamily="Bahnschrift"/>

                <Label Text="Срок выполнения" FontFamily="Bahnschrift"/>
                <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="5">
                    <DatePicker Grid.Column="0" Date="{Binding SelectedDate, Mode=TwoWay}" FontFamily="Bahnschrift"/>
                    <TimePicker Grid.Column="1" Time="{Binding SelectedTime, Mode=TwoWay}" FontFamily="Bahnschrift" IsVisible="{Binding IsDateSelected}"/>
                    <Button Grid.Column="2" Text="X" Command="{Binding ClearDueDateCommand}" FontSize="Small" IsVisible="{Binding IsDateSelected}" VerticalOptions="Center" Padding="5,0" MinimumWidthRequest="40"/>
                </Grid>

                <Label Text="Напомнить" Margin="0,10,0,0" FontFamily="Bahnschrift"/>
                <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="5">
                    <DatePicker Grid.Column="0" Date="{Binding SelectedReminderDate, Mode=TwoWay}" FontFamily="Bahnschrift" IsEnabled="{Binding IsReminderDateSelected}"/>
                    <TimePicker Grid.Column="1" Time="{Binding SelectedReminderTime, Mode=TwoWay}" FontFamily="Bahnschrift" IsVisible="{Binding IsReminderDateSelected}"/>
                    <Button Grid.Column="2" Text="X" Command="{Binding ClearReminderDateTimeCommand}" FontSize="Small" IsVisible="{Binding IsReminderDateSelected}" VerticalOptions="Center" Padding="5,0" MinimumWidthRequest="40"/>
                </Grid>
                <HorizontalStackLayout Spacing="10" Margin="0,5,0,0">
                    <Label Text="Включить напоминание:" VerticalOptions="Center" FontFamily="Bahnschrift"/>
                    <Switch IsToggled="{Binding IsReminderDateSelected, Mode=TwoWay}" />
                </HorizontalStackLayout>


                <Label Text="Приоритет" Margin="0,10,0,0" FontFamily="Bahnschrift"/>
                <Picker ItemsSource="{Binding PriorityOptions}"
                        SelectedItem="{Binding Task.Priority, Mode=TwoWay}"
                        ItemDisplayBinding="{Binding .}"
                        FontFamily="Bahnschrift"/>

                <Label Text="Категория" FontFamily="Bahnschrift"/>
                <Entry Text="{Binding Task.Category}" Placeholder="Введите категорию" FontFamily="Bahnschrift"/>

                <Label Text="Статус" FontFamily="Bahnschrift"/>
                <Picker ItemsSource="{Binding StatusOptions}"
                        SelectedItem="{Binding Task.Status, Mode=TwoWay}"
                        ItemDisplayBinding="{Binding .}"
                        FontFamily="Bahnschrift"/>

                <Button Text="Сохранить" Command="{Binding SaveTaskCommand}" HorizontalOptions="Fill" FontFamily="Bahnschrift" Margin="0,20,0,0"/>
                <Button Text="Удалить" Command="{Binding DeleteTaskCommand}" HorizontalOptions="Fill" FontFamily="Bahnschrift" BackgroundColor="DarkRed" Margin="0,10,0,0" IsVisible="{Binding Task.Id, Converter={StaticResource IntToBoolConverterForVisibility}}" />
            </VerticalStackLayout>
        </ScrollView>

        <ActivityIndicator IsRunning="{Binding IsBusy}"
                           IsVisible="{Binding IsBusy}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Color="{AppThemeBinding Light=Black, Dark=White}"/>
    </Grid>
</ContentPage>